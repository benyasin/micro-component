<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="980" height="720" viewBox="0 0 980 720">
  <defs>
    <style>
      .node{fill:#fff;stroke:#0ea5e9;stroke-width:2;rx:10;ry:10}
      .title{font:16px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;font-weight:600;fill:#0f172a}
      .txt{font:13px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;fill:#334155}
      .arrow{stroke:#64748b;stroke-width:1.8;marker-end:url(#arrow)}
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="8" refX="8" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,4 L0,8 Z" fill="#64748b"/>
    </marker>
  </defs>

  <!-- Steps -->
  <rect class="node" x="40" y="40" width="420" height="90"/>
  <text class="title" x="60" y="70">1. 宿主调用</text>
  <text class="txt" x="60" y="96">Vue/React 包装器收到 props/onXxx，生成 {type, props, el, on}</text>

  <rect class="node" x="520" y="40" width="420" height="90"/>
  <text class="title" x="540" y="70">2. 运行时初始化</text>
  <text class="txt" x="540" y="96">创建/复用 Vue3 应用、i18n、事件中心、隐藏容器</text>

  <rect class="node" x="40" y="160" width="420" height="110"/>
  <text class="title" x="60" y="190">3. 任务入队与调度</text>
  <text class="txt" x="60" y="216">生成 Task（优先级/超时控制），按序并发执行</text>

  <rect class="node" x="520" y="160" width="420" height="130"/>
  <text class="title" x="540" y="190">4. 并行加载资源</text>
  <text class="txt" x="540" y="216">动态 import 组件、注入 CSS（去重）、加载 i18n/数据</text>
  <text class="txt" x="540" y="236">缓存命中则快速返回；阶段失败触发降级</text>

  <rect class="node" x="40" y="310" width="420" height="130"/>
  <text class="title" x="60" y="340">5. Teleport 渲染</text>
  <text class="txt" x="60" y="366">将组件 vnode Teleport 到宿主传入 el，实现跨栈挂载</text>
  <text class="txt" x="60" y="386">SSR/CSR 一致；支持 keepAlive 与最小重渲染</text>

  <rect class="node" x="520" y="330" width="420" height="150"/>
  <text class="title" x="540" y="360">6. 事件桥通信</text>
  <text class="txt" x="540" y="386">组件内部 emit → Runtime 分发 → 包装器 → 宿主回调</text>
  <text class="txt" x="540" y="406">统一转为 onXxx/$listeners；支持自定义事件名</text>

  <rect class="node" x="40" y="480" width="420" height="110"/>
  <text class="title" x="60" y="510">7. 属性增量更新</text>
  <text class="txt" x="60" y="536">包装器 diff props，调用实例 updateProps 精准更新</text>

  <rect class="node" x="520" y="510" width="420" height="110"/>
  <text class="title" x="540" y="540">8. 卸载与清理</text>
  <text class="txt" x="540" y="566">等待 Vue 卸载，移除样式/事件，释放内存</text>

  <rect class="node" x="40" y="630" width="900" height="60"/>
  <text class="title" x="60" y="660">9. 可观测与指标</text>
  <text class="txt" x="290" y="660">窗口分发 CustomEvent("MicroRuntime:Metric", detail)</text>

  <!-- Arrows -->
  <line class="arrow" x1="460" y1="85" x2="520" y2="85"/>
  <line class="arrow" x1="480" y1="215" x2="520" y2="215"/>
  <line class="arrow" x1="780" y1="290" x2="780" y2="330"/>
  <line class="arrow" x1="460" y1="375" x2="520" y2="385"/>
  <line class="arrow" x1="480" y1="535" x2="520" y2="565"/>
  <line class="arrow" x1="480" y1="600" x2="940" y2="660"/>
</svg>